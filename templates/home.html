<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Matcher - JobSyncPro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous">

    <link rel="stylesheet" href="{{ url_for('static', filename='home.css') }}">

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        /* Style for the flash message */
        .flash-message {
            padding: 1rem;
            margin: 1rem auto;
            border-radius: 8px;
            color: #fff;
            max-width: 800px;
            text-align: center;
            font-weight: 500;
        }
        .flash-message.warning {
            background-color: #d97706; /* Amber color */
            border: 1px solid #fbbF24;
        }
    </style>
</head>
<body>
    <div class="bg-decoration"></div>
    <div class="bg-decoration"></div>
    <div class="bg-decoration"></div>

    <nav class="navbar">
        <div class="nav-container">
            <a href="{{ url_for('index') }}" class="logo">JobSyncPro</a>
            <ul class="nav-links">
                <li><a href="#">Home</a></li>
                <li><a href="https://github.com/yashvisharma1204/JobSyncPro">Documentation</a></li>
                <li><a href="#features">Features</a></li>
                <li><a href="#process">Process</a></li>
            </ul>
            <div class="auth-buttons">
                {% if session.user_email %}
                    <span class="user-email" style="color: #cbd5e1; padding-right: 1rem;">{{ session.user_email }}</span>
                    <a href="{{ url_for('logout') }}" class="btn btn-outline">Logout</a>
                {% endif %}
            </div>
        </div>
    </nav>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="flash-message {{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <div class="container">
        <div class="card">
            <div class="card-header">
                <h2><i class="fas fa-search"></i> AI-Powered Resume Matcher</h2>
            </div>
            <div class="card-body">
                <form method="POST" action="/matcher" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="job_description" class="form-label">
                            <i class="fas fa-file-text"></i> Job Description
                        </label>
                        <textarea
                            class="form-control"
                            id="job_description"
                            name="job_description"
                            rows="5"
                            placeholder="Enter the job description here..."
                            required
                            aria-describedby="jobDescriptionHelp"
                        ></textarea>
                        <small id="jobDescriptionHelp" class="form-text">
                            Provide a detailed job description for accurate resume matching.
                        </small>
                    </div>
                    
                    <div class="form-group">
                        <label for="resumes" class="form-label">
                            <i class="fas fa-upload"></i> Upload Resumes
                        </label>
                        <div class="file-input-wrapper">
                            <input
                                type="file"
                                id="resumes"
                                name="resumes"
                                multiple
                                accept=".pdf,.docx,.txt"
                                aria-describedby="resumesHelp"
                            >
                            <span class="file-input-label">
                                <i class="fas fa-cloud-upload-alt"></i>
                                Drag and drop resumes here or click to upload (PDF, DOCX, TXT)
                            </span>
                        </div>
                        <small id="resumesHelp" class="form-text">
                            For interview prep, please upload exactly one resume.
                        </small>
                    </div>
                    
                    <div class="form-buttons" style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <button type="submit" class="btn-submit" style="flex: 1; min-width: 200px;">
                            <i class="fas fa-magic"></i> Match Resumes
                        </button>
                        
                        <button type="submit" id="prepareBtn" class="btn-submit" formaction="{{ url_for('prep.start_interview') }}" style="flex: 1; min-width: 200px; background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);">
                            <i class="fas fa-microphone"></i> Prepare for Interview
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <footer class="footer">
        <p>&copy; 2025 JobSyncPro. Advanced Resume Matching Platform.</p>
    </footer>

    <script>
        const resumeInput = document.getElementById('resumes');
        const fileInputLabel = document.querySelector('.file-input-label');
        const prepareButton = document.getElementById('prepareBtn');

        // This event listener only updates the file count label
        resumeInput.addEventListener('change', function(e) {
            const fileCount = e.target.files.length;
            
            if (fileCount > 0) {
                fileInputLabel.innerHTML = `
                    <i class="fas fa-file-check"></i>
                    ${fileCount} file${fileCount > 1 ? 's' : ''} selected
                `;
            } else {
                fileInputLabel.innerHTML = `
                    <i class="fas fa-cloud-upload-alt"></i>
                    Drag and drop resumes here or click to upload (PDF, DOCX, TXT)
                `;
            }
        });

        // This listener handles the logic when the interview button is clicked
        prepareButton.addEventListener('click', function(event) {
            const fileCount = resumeInput.files.length;

            if (fileCount !== 1) {
                // 1. Prevent the form from submitting
                event.preventDefault();

                // 2. Show the attractive SweetAlert2 modal instead of the default alert
                Swal.fire({
                    icon: 'warning',
                    title: 'Please Select One Resume',
                    html: "For the best results, please prepare for your interview with a single, optimized resume.<br><br>We recommend using the <strong>'Match Resumes'</strong> feature first to find your strongest option, then return here to start your interview preparation with that one file.",
                    confirmButtonText: 'Understood',
                    background: '#1e293b', // Dark background to match your site
                    color: '#e2e8f0',       // Light text color
                    confirmButtonColor: '#4f46e5' // A purple for the button
                });
            }
            // If fileCount is exactly 1, this function does nothing, and the form submits as normal.
        });

        // Add smooth scrolling for navigation links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth'
                    });
                }
            });
        });

        // Add navbar scroll effect
        window.addEventListener('scroll', function() {
            const navbar = document.querySelector('.navbar');
            if (window.scrollY > 50) {
                navbar.style.background = 'rgba(15, 23, 42, 0.95)';
            } else {
                navbar.style.background = 'rgba(15, 23, 42, 0.85)';
            }
        });
    </script>
</body>
</html>